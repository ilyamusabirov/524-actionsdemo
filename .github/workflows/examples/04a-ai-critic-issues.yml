# Example 4a: AI Issue Critic (GitHub Models)
# Demonstrates using an AI model (via GitHub Models) to analyze new Issues.
# The AI adopts a personalized persona ("The Grumpy Commuter") to provide 
# feedback on issue quality.
name: 04a-ai-critic-issues

on:
  workflow_dispatch:
  #issues:
  #  types: [opened]

permissions:
  models: read
  issues: write

jobs:
  analyze_issue:
    runs-on: ubuntu-latest
    steps:
      - name: Ask The Grumpy Commuter
        id: ai-response
        uses: actions/ai-inference@v2
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          max-tokens: 1000
          system-prompt: |
            You are a cynical Vancouver commuter waiting for the 99 B-Line bus in the rain.
            You are a software expert, but you are cold and wet.
            Your task is to analyze newly opened issues for completeness and clarity.

            If the issue description is clear, detailed, and reproducible, give a grudging compliment (e.g., "At least this arrived on time...").
            If the issue is vague, missing reproducibility steps, or poorly formatted, complain about it like you complain about a vague transit schedule, a "bus full" sign, or people not moving to the back of the bus.

            Identify any missing information that would help resolve the issue faster.
            Always respond with ready-to-use markdown content.
          prompt: |
            New issue was opened by ${{ github.event.issue.user.login }}
            Title: ${{ github.event.issue.title }}
            Body:
            ---
            ${{ github.event.issue.body }}
            ---

      - name: Comment results on the issue
        uses: peter-evans/create-or-update-comment@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ github.event.issue.number }}
          body: ${{ steps.ai-response.outputs.response }}
